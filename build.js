"format register";!function(t){function e(t){for(var e=[],i=0,r=t.length;r>i;i++)-1==d.call(e,t[i])&&e.push(t[i]);return e}function i(t,i,r,n){if("string"!=typeof t)throw"System.register provided no module name";var s;s="boolean"==typeof r?{declarative:!1,deps:i,execute:n,executingRequire:r}:{declarative:!0,deps:i,declare:r},s.name=t,l[t]||(l[t]=s),s.deps=e(s.deps),s.normalizedDeps=s.deps}function r(t,e){if(e[t.groupIndex]=e[t.groupIndex]||[],-1==d.call(e[t.groupIndex],t)){e[t.groupIndex].push(t);for(var i=0,n=t.normalizedDeps.length;n>i;i++){var s=t.normalizedDeps[i],o=l[s];if(o&&!o.evaluated){var a=t.groupIndex+(o.declarative!=t.declarative);if(void 0===o.groupIndex||o.groupIndex<a){if(void 0!==o.groupIndex&&(e[o.groupIndex].splice(d.call(e[o.groupIndex],o),1),0==e[o.groupIndex].length))throw new TypeError("Mixed dependency cycle detected");o.groupIndex=a}r(o,e)}}}}function n(t){var e=l[t];e.groupIndex=0;var i=[];r(e,i);for(var n=!!e.declarative==i.length%2,s=i.length-1;s>=0;s--){for(var a=i[s],h=0;h<a.length;h++){var c=a[h];n?o(c):u(c)}n=!n}}function s(t){return f[t]||(f[t]={name:t,dependencies:[],exports:{},importers:[]})}function o(e){if(!e.module){var i=e.module=s(e.name),r=e.module.exports,n=e.declare.call(t,function(t,e){i.locked=!0,r[t]=e;for(var n=0,s=i.importers.length;s>n;n++){var o=i.importers[n];if(!o.locked){var a=d.call(o.dependencies,i);o.setters[a](r)}}return i.locked=!1,e});if(i.setters=n.setters,i.execute=n.execute,!i.setters||!i.execute)throw new TypeError("Invalid System.register form for "+e.name);for(var a=0,u=e.normalizedDeps.length;u>a;a++){var h,p=e.normalizedDeps[a],m=l[p],v=f[p];v?h=v.exports:m&&!m.declarative?h={"default":m.module.exports,__useDefault:!0}:m?(o(m),v=m.module,h=v.exports):h=c(p),v&&v.importers?(v.importers.push(i),i.dependencies.push(v)):i.dependencies.push(null),i.setters[a]&&i.setters[a](h)}}}function a(t){var e,i=l[t];if(i)i.declarative?h(t,[]):i.evaluated||u(i),e=i.module.exports;else if(e=c(t),!e)throw new Error("Unable to load dependency "+t+".");return(!i||i.declarative)&&e&&e.__useDefault?e["default"]:e}function u(e){if(!e.module){var i={},r=e.module={exports:i,id:e.name};if(!e.executingRequire)for(var n=0,s=e.normalizedDeps.length;s>n;n++){var o=e.normalizedDeps[n],h=l[o];h&&u(h)}e.evaluated=!0;var c=e.execute.call(t,function(t){for(var i=0,r=e.deps.length;r>i;i++)if(e.deps[i]==t)return a(e.normalizedDeps[i]);throw new TypeError("Module "+t+" not declared as a dependency.")},i,r);c&&(r.exports=c)}}function h(e,i){var r=l[e];if(!r.evaluated&&r.declarative){i.push(e);for(var n=0,s=r.normalizedDeps.length;s>n;n++){var o=r.normalizedDeps[n];-1==d.call(i,o)&&(l[o]?h(o,i):c(o))}r.evaluated||(r.evaluated=!0,r.module.execute.call(t))}}function c(t){if(p[t])return p[t];var e=l[t];if(!e)throw"Module "+t+" not present.";n(t),h(t,[]),l[t]=void 0;var i=e.declarative?e.module.exports:{"default":e.module.exports,__useDefault:!0};return p[t]=i}var l={},d=Array.prototype.indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(this[e]===t)return e;return-1},f={},p={};return function(e,r){var n;"undefined"!=typeof n&&n.register?(r(n),n["import"](e)):(r(n={register:i,get:c,set:function(t,e){p[t]=e},newModule:function(t){return t},global:t}),n.set("@empty",n.newModule({})),c(e))}}("undefined"!=typeof window?window:global)("lib/main",function(t){t.register("lib/tileKey",[],function(t){"use strict";return{setters:[],execute:function(){t("default",{map:{floor:".",rock:"X:100",wallVertical:"|",wallHorizontal:"-",wallCorner:"+",stairs:"<"},mobs:{rat:"r",spider:"s",player:"\u2603"}})}}}),t.register("classes/mobs/rat",["classes/mob"],function(t){"use strict";var e,i;return{setters:[function(t){e=t["default"]}],execute:function(){i=function(t){var e=function i(t){$traceurRuntime.superConstructor(i).call(this,t),this.setType(this.tiles.rat),this.health=30,this.score=2,this.damage=2};return $traceurRuntime.createClass(e,{},{},t)}(e),t("default",i)}}}),t.register("lib/render",[],function(t){"use strict";var e;return{setters:[],execute:function(){e=function(){var t=function(){this.el=document.querySelector(".js-game")};return $traceurRuntime.createClass(t,{getLeftCornerOfViewport:function(t,e){var i=t.getKeyForCoords(e.position.x,e.position.y);return i},draw:function(t,e,i,r,n){var s,o,a,u;s={x:i.position.x-i.half.width,y:i.position.y-i.half.height},o={x:i.position.x+i.half.width,y:i.position.y+i.half.height},u=[];for(var h=0,c=e.mobs.length;c>h;h++){var l=e.mobs[h];l.position.x>=s.x&&l.position.x<=o.x&&l.position.y>=s.y&&l.position.y<=o.y&&u.push(l)}a="";for(var d=s.y,f=o.y;f>d;d++){for(var p=s.x,m=o.x;m>p;p++){for(var v=e.getKeyForCoords(p,d),y=!1,g=0,x=u.length;x>g;g++)u[g].position.x===p&&u[g].position.y===d&&(y=u[g]);a+=t.position.x===p&&t.position.y===d?"<span>"+t.type+"</span>":y?"<span>"+y.type+"</span>":"<span>"+e.map[v].charAt(0)+"</span>"}a+="<br/>"}a+="Depth:"+r.depth+" Health:"+t.health+" Weapon:"+t.weapon.type+" Score:"+n.currentScore(),this.el.innerHTML=a},drawEnd:function(t,e){this.el.innerHTML="You died<br/>You managed to get to level "+t+"<br/>with a score of "+e.currentScore()+"<br/><br/>Press enter to restart"}},{})}(),t("default",new e)}}}),t.register("lib/camera",[],function(t){"use strict";var e;return{setters:[],execute:function(){e=function(){var t=function(){this.position={x:0,y:0},this.setViewportSize({width:20,height:20}),this.viewport={width:20,height:20},this.half={width:Math.floor(.5*this.viewport.width),height:Math.floor(.5*this.viewport.height)}};return $traceurRuntime.createClass(t,{setViewportSize:function(t){this.viewport=t,this.half={width:Math.floor(.5*this.viewport.width),height:Math.floor(.5*this.viewport.height)}},setViewportBounds:function(t){this.minPosition={x:this.half.width,y:this.half.height},this.maxPosition={x:t.width-this.half.width,y:t.height-this.half.height}},setPosition:function(t){this.position.x=t.x<this.minPosition.x?this.minPosition.x:t.x>this.maxPosition.x?this.maxPosition.x:t.x,this.position.y=t.y<this.minPosition.y?this.minPosition.y:t.y>this.maxPosition.y?this.maxPosition.y:t.y},move:function(t){this.setPosition({x:this.position.x+t.x,y:this.position.y+t.y})}},{})}(),t("default",new e)}}}),t.register("lib/io",[],function(t){"use strict";var e;return{setters:[],execute:function(){e=function(){var t=function(){this.bindKeyboard(),this.activeKeys=[]};return $traceurRuntime.createClass(t,{bindKeyboard:function(){var t=this;window.addEventListener("keydown",function(e){t.keyPressed(e)},!1),window.addEventListener("keyup",function(e){t.keyReleased(e)},!1)},keyPressed:function(t){-1===this.activeKeys.indexOf(t.keyCode)&&this.activeKeys.push(t.keyCode),13===t.keyCode&&this.triggerEnd()},keyReleased:function(t){var e=this.activeKeys.indexOf(t.keyCode);-1!==e&&this.activeKeys.splice(e,1)},getDirection:function(){var t=-1!==this.activeKeys.indexOf(37)?-1:0,e=-1!==this.activeKeys.indexOf(39)?1:0,i=-1!==this.activeKeys.indexOf(38)?-1:0,r=-1!==this.activeKeys.indexOf(40)?1:0;return{x:t+e,y:i+r}},triggerEnd:function(){}},{})}(),t("default",new e)}}}),t.register("lib/loop",[],function(t){"use strict";var e;return{setters:[],execute:function(){e=function(){var t=function(){this.fps=1e3/60,this.pause=!0};return $traceurRuntime.createClass(t,{start:function(){this.pause=!1,this.startTime=(new Date).getTime(),this.timeSinceLastUpdate=0,this.tick(0)},stop:function(){this.pause=!0},tick:function(t){if(!this.pause){var e=(new Date).getTime()-this.startTime,i=t-e;this.timeSinceLastUpdate+=i,this.timeSinceLastUpdate>this.fps&&(this.update(),this.timeSinceLastUpdate=0),this.draw(),window.requestAnimationFrame?window.requestAnimationFrame(this.tick.bind(this)):this.raf()}},raf:function(){var t=this,e=1e3/60;setTimeout(function(){t.tick.bind(t)},e)},update:function(){},draw:function(){}},{})}(),t("default",new e)}}}),t.register("lib/player",["lib/tileKey"],function(t){"use strict";var e,i;return{setters:[function(t){e=t["default"]}],execute:function(){i=function(){var t=function(){this.position={x:null,y:null},this.type=e.mobs.player,this.health=100,this.maxHealth=100,this.weapon=null};return $traceurRuntime.createClass(t,{setPosition:function(t){this.position.x=t.x,this.position.y=t.y},move:function(t){this.setPosition({x:this.position.x+t.x,y:this.position.y+t.y})},heal:function(t){this.health+=t,this.health>this.maxHealth&&(this.health=this.maxHealth)},injure:function(t){this.health-=t},arm:function(t){this.weapon=t}},{})}(),t("default",new i)}}}),t.register("classes/weapon",[],function(t){"use strict";var e;return{setters:[],execute:function(){e=function(){var t=function(){this.type="weapon",this.damage=1,this.bonus=[]};return $traceurRuntime.createClass(t,{},{})}(),t("default",e)}}}),t.register("lib/score",[],function(t){"use strict";var e;return{setters:[],execute:function(){e=function(){var t=function(){this.reset()};return $traceurRuntime.createClass(t,{reset:function(){this.gold=0,this.points=0,this.kills=0},addKill:function(t){this.kills+=t},addPoints:function(t,e){this.points+=t*e},addGold:function(t){this.gold+=t},currentScore:function(){return this.gold+this.points+this.kills}},{})}(),t("default",new e)}}}),t.register("classes/mob",["lib/tileKey"],function(t){"use strict";var e,i;return{setters:[function(t){e=t["default"]}],execute:function(){i=function(){var t=function(t){this.position={},this.setPosition(t.position),this.setType("?"),this.setWait(20),this.health=20,this.damage=1,this.score=1,this.modes={0:"normal"},this.mode=0,this.tiles=e.mobs};return $traceurRuntime.createClass(t,{setPosition:function(t){this.position.x=t.x,this.position.y=t.y},setWait:function(t){this.moveTime=t,this.waitTime=t},setType:function(t){this.type=t},move:function(){if(this.waitTime>0)return void this.waitTime--;this.waitTime=this.moveTime;var t=Math.random(),e=0,i=0;.25>t?e=-1:.5>t?e=1:i=.75>t?-1:1;this.position.x,this.position.y;this.position.x+=e,this.position.y+=i},setMode:function(t){this.mode=t},heal:function(t){this.health+=t},injure:function(t){return this.health-=t,this.health<=0?!1:Math.random()>.4}},{})}(),t("default",i)}}}),t.register("classes/weapons/pickaxe",["classes/weapon","lib/tileKey"],function(t){"use strict";var e,i,r;return{setters:[function(t){e=t["default"]},function(t){i=t["default"]}],execute:function(){r=function(t){var e=function r(){$traceurRuntime.superConstructor(r).call(this),this.type="Pickaxe",this.bonus=i.map.rock.charAt(0)};return $traceurRuntime.createClass(e,{},{},t)}(e),t("default",r)}}}),t.register("classes/mobs/spider",["classes/mob"],function(t){"use strict";var e,i;return{setters:[function(t){e=t["default"]}],execute:function(){i=function(t){var e=function i(t){$traceurRuntime.superConstructor(i).call(this,t),this.setType(this.tiles.spider),this.setWait(40)};return $traceurRuntime.createClass(e,{},{},t)}(e),t("default",i)}}}),t.register("lib/weapons",["classes/weapons/pickaxe"],function(t){"use strict";var e,i;return{setters:[function(t){e=t["default"]}],execute:function(){i=function(){var t=function(){this.pickaxe=e};return $traceurRuntime.createClass(t,{},{})}(),t("default",new i)}}}),t.register("lib/mobs",["classes/mobs/spider","classes/mobs/rat"],function(t){"use strict";var e,i,r;return{setters:[function(t){e=t["default"]},function(t){i=t["default"]}],execute:function(){r=function(){var t=function(){this.mobs={spider:e,rat:i}};return $traceurRuntime.createClass(t,{getNumberOfMobs:function(){var t=0;for(var e in this.mobs)this.mobs.hasOwnProperty(e)&&t++;return t},getRandomMob:function(){var t=Math.floor(this.getNumberOfMobs()*Math.random()),e=0;for(var i in this.mobs)if(this.mobs.hasOwnProperty(i)){if(e===t)return this.mobs[i];e++}return!1}},{})}(),t("default",new r)}}}),t.register("lib/level",["lib/mobs","lib/tileKey"],function(t){"use strict";var e,i,r;return{setters:[function(t){e=t["default"]},function(t){i=t["default"]}],execute:function(){r=function(){var t=function(){this.CAVERN_SIZE=50*Math.random()+200,this.MINORS=50*Math.random()+100,this.MOBS=100};return $traceurRuntime.createClass(t,{init:function(t,e){return this.width=t,this.height=e,this.map=[],this.generateMap(),this.createMobs(),this.createEndPoint(),this.createStartPoint()},getCoordsForKey:function(t){if(0===t)return[0,0];var e=Math.floor(t/this.width),i=t%this.width;return[i,e]},getKeyForCoords:function(t,e){return e*this.width+t},isKeyValid:function(t){return t>0&&t<=this.map.length},isCoordsValid:function(t,e){return t>=0&&t<this.width&&e>=0&&e<this.height},generateMap:function(){for(var t=0,e=this.width*this.height;e>t;t++)this.map[t]=i.map.rock;for(var r=0,n=this.MINORS;n>r;r++)this.mineMap(Math.floor(Math.random()*this.map.length));for(var s=0,o=this.width;o>s;s++){this.map[s]=i.map.wallHorizontal;var a=this.getKeyForCoords(s,this.height-1);this.map[a]=i.map.wallHorizontal}for(var u=0,h=this.height;h>u;u++){var c=this.getKeyForCoords(0,u);this.map[c]=i.map.wallVertical,c=this.getKeyForCoords(this.width-1,u),this.map[c]=i.map.wallVertical}this.map[0]=i.map.wallCorner,this.map[this.width-1]=i.map.wallCorner,this.map[this.width*this.height-1]=i.map.wallCorner,this.map[this.width*this.height-this.width]=i.map.wallCorner},mineMap:function(t){for(var e=this.getCoordsForKey(t),i=Math.random()>.3,r=0,n=this.CAVERN_SIZE;n>r;r++){var s=Math.random();this.minePoint(e[0],e[1],i),.25>s?e[0]+=1:.5>s?e[0]-=1:.75>s?e[1]+=1:e[1]-=1}},minePoint:function(t,e,r){this.isCoordsValid(t,e)&&(this.map[this.getKeyForCoords(t,e)]=i.map.floor),r&&(this.isCoordsValid(t-1,e)&&(this.map[this.getKeyForCoords(t-1,e)]=i.map.floor),this.isCoordsValid(t+1,e)&&(this.map[this.getKeyForCoords(t+1,e)]=i.map.floor),this.isCoordsValid(t,e-1)&&(this.map[this.getKeyForCoords(t,e-1)]=i.map.floor),this.isCoordsValid(t,e+1)&&(this.map[this.getKeyForCoords(t,e+1)]=i.map.floor))},getFreePosition:function(){var t,e;do t=Math.floor(Math.random()*this.map.length);while(this.map[t]!==i.map.floor);return e=this.getCoordsForKey(t),{x:e[0],y:e[1]}},createMobs:function(){this.mobs=[];for(var t=0,i=this.MOBS;i>t;t++){var r=this.getFreePosition(),n=e.getRandomMob(),s=new n({position:r});this.mobs.push(s)}},createStartPoint:function(){var t=this.getFreePosition();return t},createEndPoint:function(){var t=this.getFreePosition();this.map[this.getKeyForCoords(t.x,t.y)]=i.map.stairs},moveMob:function(t){var e,i,r;e=t.position.x,i=t.position.y,t.move(),r=this.getKeyForCoords(t.position.x,t.position.y),"."!==this.map[r]&&(t.position.x=e,t.position.y=i)},removeDeadMobs:function(){for(var t=[],e=0,i=0,r=this.mobs.length;r>i;i++){var n=this.mobs[i];n.health>0?t.push(n):e+=n.score}return this.mobs=t,e}},{})}(),t("default",new r)}}}),t.register("lib/game",["lib/level","lib/render","lib/camera","lib/io","lib/loop","lib/player","lib/weapons","lib/tileKey","lib/score"],function(t){"use strict";var e,i,r,n,s,o,a,u,h,c;return{setters:[function(t){e=t["default"]},function(t){i=t["default"]},function(t){r=t["default"]},function(t){n=t["default"]},function(t){s=t["default"]},function(t){o=t["default"]},function(t){a=t["default"]},function(t){u=t["default"]},function(t){h=t["default"]}],execute:function(){c=function(){var t=function c(t,h){var l,d=this,f=300,p=300;this.end=!1,this.depth=h||0,this.width=200,this.height=200,l=e.init(this.width,this.height),o.setPosition(l),o.arm(new a.pickaxe),r.setViewportSize({width:40,height:30}),r.setViewportBounds(e),r.setPosition({x:l.x,y:l.y}),s.update=function(){var i=e.getKeyForCoords(o.position.x,o.position.y);e.map[i]===u.map.stairs&&(t.addPoints(100),d=new c(t,d.depth+1)),o.health<=0&&(s.stop(),d.end=!0);var a=n.getDirection(),h=e.getKeyForCoords(o.position.x+a.x,o.position.y+a.y);if(!d.canPlayerMove(a)||0===a.x&&0===a.y)switch(e.map[h].charAt(0)){case u.map.rock.charAt(0):var l=parseInt(e.map[h].substring(2),10);if(l>0){var m=o.weapon.bonus===e.map[h].charAt(0)?3:1;e.map[h]=u.map.rock.charAt(0)+":"+(l-1*m)}else e.map[h]=u.map.floor}else{var v=d.battle(h);v||(o.move(a,e.map),r.setPosition(o.position))}for(var y=0,g=e.mobs.length;g>y;y++)e.moveMob(e.mobs[y]);0>=f?(o.heal(1),f=p):f--},s.draw=function(){d.end?(i.drawEnd(h,t),n.triggerEnd=function(){location.reload()}):i.draw(o,e,r,d,t)},s.start()};return $traceurRuntime.createClass(t,{canPlayerMove:function(t){var i={x:o.position.x+t.x,y:o.position.y+t.y},r=e.getKeyForCoords(i.x,i.y);return"."===e.map[r]||">"===e.map[r]},battle:function(t){for(var i=e.getCoordsForKey(t),r=0,n=e.mobs.length;n>r;r++){var s=e.mobs[r];if(i[0]===s.position.x&&i[1]===s.position.y){var a=s.injure(o.weapon.damage);if(a)o.injure(s.damage);else{var u=e.removeDeadMobs();h.addKill(u)}return!0}}return!1}},{})}(),t("default",new c(h,1))}}}),t.register("lib/main",["lib/game"],function(t){"use strict";var e;return{setters:[function(t){e=t["default"]}],execute:function(){t("default",{})}}})});
//# sourceMappingURL=build.js.map